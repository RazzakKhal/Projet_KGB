CREATE TABLE Agent (
CODE_AGENT INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOM VARCHAR(36) NOT NULL,
PRENOM VARCHAR(36) NOT NULL,
DATE INT NOT NULL,
NATIONALITE VARCHAR(36) NOT NULL,
SPECIALITE VARCHAR(36) NOT NULL,
MISSION_AGENT INT NOT NULL,
FOREIGN KEY (MISSION) REFERENCES Mission(ID)
);

CREATE TABLE Contact(
ID_CONTACT INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOM VARCHAR(36) NOT NULL,
PRENOM VARCHAR(36) NOT NULL,
DATE INT NOT NULL,
NOMCODE_CONTACT VARCHAR(36) NOT NULL UNIQUE,
NATIONALITE VARCHAR(36) NOT NULL,
MISSION_CONTACT INT NOT NULL,
FOREIGN KEY (MISSION) REFERENCES Mission(ID)
);

CREATE TABLE Cible(
ID_CIBLE INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOM VARCHAR(36) NOT NULL,
PRENOM VARCHAR(36) NOT NULL,
DATE INT NOT NULL,
NOMCODE_CIBLE VARCHAR(36) NOT NULL UNIQUE,
NATIONALITE VARCHAR(36) NOT NULL,
MISSION_CIBLE INT NOT NULL,
FOREIGN KEY (MISSION) REFERENCES Mission(ID)
);

CREATE TABLE Planque(
CODE_PLANQUE INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
ADRESSE VARCHAR(36) NOT NULL,
PAYS VARCHAR(36) NOT NULL,
TYPE VARCHAR(36) NOT NULL,
MISSION_PLANQUE INT NULL,
FOREIGN KEY (MISSION) REFERENCES Mission(ID)

);

CREATE TABLE Mission (
ID_MISSION INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
TITRE_M VARCHAR(36) NOT NULL,
DESCRIPTION_M CHAR(300) NOT NULL,
NOMCODE_M VARCHAR (36) NOT NULL UNIQUE,
PAYS_M VARCHAR(36) NOT NULL,
TYPE_M VARCHAR(36) NOT NULL,
STATUT_M VARCHAR(36) NOT NULL,
DATEDEBUT_M INT NOT NULL,
DATEFIN_M INT NULL,
SPECIALITE_M VARCHAR(36) NOT NULL
);

CREATE TABLE Admin(
ID INT NOT NULL PRIMARY KEY,
NOM VARCHAR(36) NOT NULL,
PRENOM VARCHAR(36)NOT NULL,
MAIL VARCHAR(255) NOT NULL,
PASS VARCHAR(60) NOT NULL,
DATE INT NOT NULL
);


CREATE TABLE Specialite(
ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
TYPE VARCHAR(36) NOT NULL
);

CREATE TABLE SpeAgent(
AGENT_ID INT NOT NULL,
SPECIALITE_ID INT NOT NULL,
PRIMARY KEY (AGENT_ID, SPECIALITE_ID),
FOREIGN KEY (AGENT_ID) REFERENCES Agent(CODE),
FOREIGN KEY (SPECIALITE_ID) REFERENCES Specialite(ID)
);


INSERT INTO Mission (titre, description, nomcode, pays, type, statut, datedebut, datefin, specialite) VALUES ('Tuer Kenny', 'Votre mission consistera à tuer Mr Kenny', 'killer', 'France', 'assassinat', 'en cours', 1643751722, null, 'assassinat' );
INSERT INTO Mission (titre, description, nomcode, pays, type, statut, datedebut, datefin, specialite) VALUES ('Surveiller Ben Laden', 'Votre mission consistera à surveiller Ben Laden', 'look', 'Afghanistan', 'surveillance', 'en cours', 1643751722, null, 'surveillance' );
INSERT INTO Mission (titre, description, nomcode, pays, type, statut, datedebut, datefin, specialite) VALUES ('Infiltrer la Maison Blanche', 'Votre mission consistera à Infiltrer la Maison Blanche', 'gogo', 'Etats-unis', 'infiltration', 'en cours', 1643751722, null, 'infiltration' );
INSERT INTO SPECIALITE (type) VALUES ('assassinat');
INSERT INTO SPECIALITE (type) VALUES ('surveillance');
INSERT INTO SPECIALITE (type) VALUES ('infiltration');
INSERT INTO AGENT(nom, prenom, date, nationalite, mission) VALUES ('Pepy', 'Marvin', 476149063, 'Française', 2);
INSERT INTO AGENT(nom, prenom, date, nationalite, mission) VALUES ('Gabin', 'Jean', 489105463, 'Française', 1);
INSERT INTO AGENT(nom, prenom, date, nationalite, mission) VALUES ('Delau', 'Victor', 373505863, 'Française', 3);
INSERT INTO CONTACT(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Boulet', 'George', 310347463,'le cinglé', 'Française', 2);
INSERT INTO CONTACT(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Palerme', 'Tanguy', 1643759142,'le peureux', 'Française', 1);
INSERT INTO CONTACT(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Pipeau', 'François', 806625463,'le truand', 'Française', 3);
INSERT INTO CIBLE(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Southpark', 'Kenny', 310347463,'immortel', 'Americaine', 2);
INSERT INTO CIBLE(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Laden', 'Ben', -404353337,'le terroriste', 'Afghane', 1);
INSERT INTO CIBLE(nom, prenom, date, nomcode, nationalite, mission) VALUES ('Maison', 'Blanche', 1643759187,'la belle', 'Americaine', 3);
INSERT INTO PLANQUE(adresse, pays, type, mission) VALUES ('14 chemin dici', 'France', 'Cabane', 1);
INSERT INTO PLANQUE(adresse, pays, type, mission) VALUES ('11 chemin dici', 'France', 'Maison', 2);
INSERT INTO PLANQUE(adresse, pays, type, mission) VALUES ('9 chemin dici', 'Etats-unis', 'Maison', 3);
INSERT INTO SPEAGENT(agent_id, specialite_id) VALUES (2, 1);
INSERT INTO SPEAGENT(agent_id, specialite_id) VALUES (1, 2);
INSERT INTO SPEAGENT(agent_id, specialite_id) VALUES (3, 3);


ALTER TABLE MISSION MODIFY DESCRIPTION_M VARCHAR(255) NOT NULL;
INSERT INTO AGENT(nom, prenom, date, nationalite, mission_agent) VALUES ('tito', 'test', 476149063, 'Française', 2);
INSERT INTO CONTACT(nom, prenom, date, nomcode_contact, nationalite, mission_contact) VALUES ('test', 'test', 310347463,'toto', 'Française', 2);

    public function chargementMissionAccueil()
    {
        $pdo = $this->getBdd();
        $req = $pdo->prepare('SELECT titre_m, description_m, nomcode_m, pays_m, code_agent, nomcode_contact, nomcode_cible, type_m, statut_m, specialite_m, datedebut_m, datefin_m, code_planque  FROM Mission ');
        $req->execute();
        $mesmissions = $req->fetchAll(PDO::FETCH_ASSOC);
        echo "<pre>";
        print_r($mesmissions);
        echo "</pre>";
        $req->closeCursor();

        foreach ($mesmissions as $missions) {
            $m =  new Mission($missions['titre_m'], $missions['description_m'], $missions['nomcode_m'], $missions['pays_m'], [$missions['code_agent']], [$missions['nomcode_contact']], [$missions['nomcode_cible']], $missions['type_m'], $missions['statut_m'], $missions['specialite_m'], $missions['datedebut_m'], $missions['datefin_m'], [$missions['code_planque']]);
            $this->setMission($m);
        }
    }
}
